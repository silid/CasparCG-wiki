'''Document history'''
* '''1.0''' 2009-04-15 Niklas P Andersson
* '''1.1''' 2010-03-08 Niklas P Andersson


=Advanced Media Control Protocol - AMCP=
* All communication is presumed to be encoded in UTF-8.
* Each command has to be terminated with both a carriage return and'' ''a linefeed character. (\r\n, <CR><LF>, <0x0D><0x0A> or <13><10>, whichever your programming language likes best). 
* The whole command string is '''case insensitive.''' 
* And since the parameters in a command is separated by spaces, you need to enclose the parameter with quotation marks if you want it to contain spaces.

==Special sequences==
Since bare quotation marks are used to keep parameters with spaces in one piece, there has to be another way to indicate a quotation mark ''in'' a string. Enter special sequences. Thay behave as in most programming languages. The escape character is backslash (’\’). In order to get a quotation mark you enter \”. The full list of valid sequences is just below.


{| width="464" border="1" frame="BELOW" rules="ROWS" cellpadding="7" frame="BELOW" rules="ROWS"
|- valign="TOP"
| width="55" |
'''sequence'''
| width="382" |
'''result'''
|- valign="TOP"
| width="55" |
\”
| width="382" |
Quotation mark.
|- valign="TOP"
| width="55" |
\\
| width="382" |
Backslash. 
|- valign="TOP"
| width="55" |
\n
| width="382" |
New line
|}

<br />

These sequences apply to all parameters, it doesn’t matter if it’s a file name or a long string of xml-data.

==Channels==
Channels are referred to using a one-based index. That is, the first channel is Channel 1 and so on.

=Play-out commands=

==LOAD==

'''Syntax''' <font face="Courier New, monospace">LOAD </font><font face="Courier New, monospace">''channel''</font><font face="Courier New, monospace"> </font><font face="Courier New, monospace">''file''</font><font face="Courier New, monospace"> [loop]</font>

<br />

LOAD loads and prepares a clip for playout. Load stops any currently playing clip and displays the first frame of the new clip. Supply the LOOP parameter if you want the clip to loop.

==LOADBG==

'''Syntax''' <font face="Courier New, monospace">LOADBG </font><font face="Courier New, monospace">''channel''</font><font face="Courier New, monospace"> </font><font face="Courier New, monospace">''file''</font><font face="Courier New, monospace"> [loop] [</font><font face="Courier New, monospace">''transition''</font><font face="Courier New, monospace">] [</font><font face="Courier New, monospace">''duration''</font><font face="Courier New, monospace">] [</font><font face="Courier New, monospace">''direction''</font><font face="Courier New, monospace">] [</font><font face="Courier New, monospace">''border''</font><font face="Courier New, monospace">] [</font><font face="Courier New, monospace">''border-width''</font><font face="Courier New, monospace">]</font>

<br />

LOADBG loads and prepares a clip for playout ''in the background''. It does not affect the currently playing clip in anyway. This is how you prepare a transition between to clips. Supply the LOOP parameter if you want the clip to loop.

===Parameters===

{| width="600" border="1" cellpadding="7"
|- valign="TOP"
| width="104" |
'''Parameter'''
| width="177" |
'''valid values'''
| width="276" |
'''Comment'''
|- valign="TOP"
| width="104" |
transition
| width="177" |
Cut (default), Mix, Push, Slide, Wipe
| width="276" |
The type of transition
|- valign="TOP"
| width="104" |
duration
| width="177" |
0 (default) - 65535
| width="276" |
The length of the transition in frames
|- valign="TOP"
| width="104" |
direction
| width="177" |
Right / Fromleft (default), Left / Fromright
| width="276" |
Push, slide and wipe needs a direction
|- valign="TOP"
| width="104" |
border
| width="177" |
''filename'' / ''<nowiki>#aarrggbb</nowiki>''
| width="276" |
Push, slide and wipe can have a border
|- valign="TOP"
| width="104" |
border-width
| width="177" |
0 (default) - 65535
| width="276" |
The width of the border if it’s not an image
|}

==PLAY==

'''Syntax''' <font face="Courier New, monospace">PLAY </font><font face="Courier New, monospace">''channel''</font>

<br />

Starts the playout on a channel. If a transition is prepared it will execute and then the new clip will keep playing.

==STOP==

'''Syntax''' <font face="Courier New, monospace">STOP </font><font face="Courier New, monospace">''channel''</font>

<br />

Stops the playout on a channel. Nothing is done to prevent flickering if the channel is operating in a fields-based videomode.

==CLEAR==

'''Syntax''' <font face="Courier New, monospace">CLEAR </font><font face="Courier New, monospace">''channel''</font>

<br />

Stops the playout if running and removes anything visible (by loading an transparent black frame). Please note that this DOES NOT AFFECT any template graphics that happens to be visible.

<br />

=Template data=

==Format==

Data to templates is sent in xml. The xml is formated like this:

<font face="Courier New, monospace"><templateData>

<componentData id="f0">

<data id="text" value="Niklas P Andersson" /> </componentData>

<componentData id="f1">

<data id="text" value="Developer" />

</componentData>

<componentData id="f2">

<data id="text" value="Providing an example" />

</componentData>

</templateData>
</font>
<br />

The node under each componentData is sent directly into the specified component. This makes it possible to provide completely custom data to templates. The data-nodes in this example is just the way the default CasparCG textfield wants its data. More information about this will be provided with the tools and actionscript classes required to build your own templates.

<br />

'''A complete call'''''' to CG ADD (see below), correctly escaped and with the data above would look like this:'''

<font face="Courier New, monospace">CG 1 ADD 0 "</font><font face="Courier New, monospace">demo/test" 1 "<templateData><componentData id=\"f0\"><data id=\"text\" value=\"Niklas P Andersson\"></data> </componentData><componentData id=\"f1\"><data id=\"text\" value=\"developer\"></data></componentData><componentData id=\"f2\"><data id=\"text\" value=\"Providing an example\"></data> </componentData></templateData>"</font>

==DATA commands==

The DATA commands are convenient to use when you have large datasets that might not be available at broadcast-time. DATA allows you to store a dataset on the CasparCG Server and assign it to a much shorter name. This name can then be used to recall the data when displaying a template graphic.

===STORE===

'''Syntax''' <font face="Courier New, monospace">DATA STORE </font><font face="Courier New, monospace">''name data''</font>

Stores the dataset ''data'' under the name ''name.''

===RETRIEVE===

'''Syntax''' <font face="Courier New, monospace">DATA RETRIEVE </font><font face="Courier New, monospace">''name''</font>

Returns the data saved under the name ''name.''

===LIST===

'''Syntax''' <font face="Courier New, monospace">DATA LIST</font>

Returns a list of all saved datasets''.''

<br />

=Commands for template graphics=

'''Syntax''' <font face="Courier New, monospace"> CG </font><font face="Courier New, monospace">''channel''</font><font face="Courier New, monospace"> </font><font face="Courier New, monospace">''command''</font><font face="Courier New, monospace"> [</font><font face="Courier New, monospace">''parameters''</font><font face="Courier New, monospace">]</font>

==CG commands==

===ADD===

'''Syntax''' <font face="Courier New, monospace">CG </font><font face="Courier New, monospace">''channel''</font><font face="Courier New, monospace"> ADD </font><font face="Courier New, monospace">''layer template [play-on-load] [data]''</font>

'''Example''' <font face="Courier New, monospace">CG 1 ADD 10 svtnews/info 1</font>

Prepares a template for displaying. It won’t show until you call CG PLAY (unless you supply the play-on-load flag, which is simply a ‘1’. ‘0’ for “don’t play on load”). ''data '' is either inline xml or a reference to a saved dataset. Please see the '''Template data / Format''' section above for a complete example with data.

===REMOVE===

'''Syntax''' <font face="Courier New, monospace">CG </font><font face="Courier New, monospace">''channel''</font><font face="Courier New, monospace"> REMOVE </font><font face="Courier New, monospace">''layer''</font>

Removes the visible template from a specific layer.

===CLEAR===

'''Syntax''' <font face="Courier New, monospace">CG </font><font face="Courier New, monospace">''channel ''</font><font face="Courier New, monospace">CLEAR</font>

Clears all layers and any state that might be stored. What this actually does behind the scene is to create a new instance of the Adobe Flash player ActiveX controller in memory.

===PLAY===

'''Syntax''' <font face="Courier New, monospace">CG </font><font face="Courier New, monospace">''channel ''</font><font face="Courier New, monospace">PLAY </font><font face="Courier New, monospace">''layer''</font>

Plays / displays the template in the specified layer

===STOP===

'''Syntax''' <font face="Courier New, monospace">CG </font><font face="Courier New, monospace">''channel ''</font><font face="Courier New, monospace">STOP </font><font face="Courier New, monospace">''layer''</font>

Stops and removes the template from the specified layer. This is different than REMOVE in that the template gets a chance to animate out when it is stopped.

===NEXT===

'''Syntax''' <font face="Courier New, monospace">CG </font><font face="Courier New, monospace">''channel''</font><font face="Courier New, monospace"> NEXT </font><font face="Courier New, monospace">''layer''</font>

Triggers a ”continue” in the template on the specified layer. This is used to control animations that has multiple discreet steps.

===GOTO===

'''Syntax''' <font face="Courier New, monospace">CG </font><font face="Courier New, monospace">''channel ''</font><font face="Courier New, monospace">GOTO </font><font face="Courier New, monospace">''layer label''</font>

Jumps to the specified label in the template on the specified layer.

===UPDATE===

'''Syntax''' <font face="Courier New, monospace">CG </font><font face="Courier New, monospace">''channel ''</font><font face="Courier New, monospace">UPDATE</font><font face="Courier New, monospace">'' layer data''</font>

Sends new data to the template on specified layer. ''data'' is either inline xml or a reference to a saved dataset.

===INVOKE===

'''Syntax''' <font face="Courier New, monospace">CG </font><font face="Courier New, monospace">''channel''</font><font face="Courier New, monospace"> INVOKE </font><font face="Courier New, monospace">''layer method''</font>

Calls a custom method in the document class of the template on the specified layer. The method must return void and take no parameters.

=Commands for statistics and status=

==CINF==

'''Syntax''' <font face="Courier New, monospace">CINF </font><font face="Courier New, monospace">''filename''</font>

<br />

Returns information about a mediafile

==CLS==

'''Syntax''' <font face="Courier New, monospace">CLS</font>

<br />

Lists all mediafiles

==TLS==

'''Syntax''' <font face="Courier New, monospace">TLS [</font><font face="Courier New, monospace">''folder''</font><font face="Courier New, monospace">]</font>

<br />

Lists all templates. Lists only templates in the specified folder, if provided.

==VERSION==

'''Syntax''' <font face="Courier New, monospace">VERSION</font>

<br />

Returns the version of the server.

==INFO==

'''Syntax''' <font face="Courier New, monospace">INFO [</font><font face="Courier New, monospace">''channel''</font><font face="Courier New, monospace">]</font>

<br />

Returns information about the channels on the server. Use this without parameters to check how many channels a server has.

=Misc commands=

==BYE==

'''Syntax''' <font face="Courier New, monospace">BYE</font>

<br />

Disconnects from the server.

=Return codes=

==1xx (Informational)==

These return codes are reserved for future use as parts of a client-to-client status update system. The idea is to facilitate monitoring from a client by means of sending a command, for example MONITOR. This could be used to keep a client up to date on, for example, which clips are loaded on a monitored server.

{| width="601" border="1" cellpadding="3"
|- valign="TOP"
| width="186" |
<font color="#000000"><font face="Verdana, sans-serif">100 [action] </font></font>
| width="401" |
<font face="Verdana, sans-serif">Information about an event.</font>
|- valign="TOP"
| width="186" |
<font color="#000000"><font face="Verdana, sans-serif">101 [action] </font></font>
| width="401" |
<font face="Verdana, sans-serif">Information about an event. A line of data is being returned.</font>
|}

==2xx (Successful)==

{| width="600" border="1" cellpadding="3"
|- valign="TOP"
| width="186" |
<font color="#000000"><font face="Verdana, sans-serif">202 [command] OK </font></font>
| width="401" |
<font face="Verdana, sans-serif">The command has been executed </font>
|- valign="TOP"
| width="186" |
<font face="Verdana, sans-serif">201 [command] OK </font>
| width="401" |
<font face="Verdana, sans-serif">The command has been executed and a line of data is being returned</font>
|- valign="TOP"
| width="186" |
<font face="Verdana, sans-serif">200 [command] OK </font>
| width="401" |
<font color="#000000"><font face="Verdana, sans-serif">The command has been executed and several lines of data are being returned (terminated by an empty line.)</font></font>
|}

==4xx (Client error)==

{| width="601" border="1" cellpadding="3"
|- valign="TOP"
| width="186" |
<font face="Verdana, sans-serif">400 ERROR </font>
| width="401" |
<font face="Verdana, sans-serif">Command not understood </font>
|- valign="TOP"
| width="186" |
<font face="Verdana, sans-serif">401 [command] ERROR </font>
| width="401" |
<font face="Verdana, sans-serif">Illegal channel </font>
|- valign="TOP"
| width="186" |
<font face="Verdana, sans-serif">402 [command] ERROR </font>
| width="401" |
<font face="Verdana, sans-serif">Parameter missing </font>
|- valign="TOP"
| width="186" |
<font face="Verdana, sans-serif">403 [command] ERROR </font>
| width="401" |
<font face="Verdana, sans-serif">Illegal parameter </font>
|- valign="TOP"
| width="186" |
<font face="Verdana, sans-serif">404 [command] ERROR </font>
| width="401" |
<font face="Verdana, sans-serif">Media file not found </font>
|}

==5xx (Server error)==

{| width="601" border="1" cellpadding="3"
|- valign="TOP"
| width="186" |
<font face="Verdana, sans-serif">500 FAILED </font>
| width="401" |
<font face="Verdana, sans-serif">Internal server error</font>
|- valign="TOP"
| width="186" |
<font face="Verdana, sans-serif">501 [command] FAILED </font>
| width="401" |
<font face="Verdana, sans-serif">Internal server error</font>
|- valign="TOP"
| width="186" |
<font face="Verdana, sans-serif">502 [command] FAILED </font>
| width="401" |
<font face="Verdana, sans-serif">Media file unreadable </font>
|}

<br />

[[Category:Communication Protocol]]